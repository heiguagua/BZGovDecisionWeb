"use strict";!function(){function e(e,t,a){function n(e,t){return{request:function(e){e.withCredentials=!0;screen.width,screen.height,.7*$(".content-box").height()+"px";return e},requestError:function(e){return e},response:function(t){return e.when(t,function(e){}),t},responseError:function(e){return e}}}t.otherwise("/dashboard"),e.state("dashboard",{url:"/dashboard",templateUrl:"partials/dashboard/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("main",{url:"/main/:mid/:typeid/:murl",templateUrl:"partials/main/view.html",controller:"mainController",controllerAs:"main"}).state("login",{url:"/login",templateUrl:"partials/login/view.html",controller:"loginController",controllerAs:"login"}).state("main.preview",{url:"/preview/:preid",templateUrl:"partials/preview/view.html",controller:"previewController",controllerAs:"preview"}).state("main.module",{url:"/module/:id/:url",templateUrl:"partials/module/view.html",controller:"moduleController",controllerAs:"module"}).state("main.file",{url:"/file/:furl",templateUrl:"partials/file/view.html",controller:"fileController",controllerAs:"file"}).state("main.module.content",{url:"/content/:tid",templateUrl:"partials/module/content/view.html",controller:"contentController",controllerAs:"content"}).state("main.module.content.detail",{url:"/detail/:pid",templateUrl:"partials/module/content/detail/view.html",controller:"detailController",controllerAs:"detail"}),a.interceptors.push(n),n.$inject=["$q","$location"]}angular.module("app",["ngAnimate","ui.router","common.http","app.dashboard","app.login","app.main","app.file","app.main.preview","app.main.module","app.main.module.content","app.main.module.content.detail"]).config(e),e.$inject=["$stateProvider","$urlRouterProvider","$httpProvider"]}(),function(){var e=angular.module("common.http",[]);e.constant("URL",location.protocol+"//"+location.host+"/govDecisionServer"),e.factory("validate",[function(){return function(e,t){var a=function(t){return e&&e.head&&e.head.status===t};switch(t){case 200:return a(t);case 201:return a(t);case 202:return a(t);case 400:return a(t);case 404:return a(t);case 405:return a(t);case 415:return a(t);case 500:return a(t)}}}])}(),function(){var e=angular.module("app.dashboard",[]);e.$inject=["$location"],e.controller("dashboardController",["$scope","dashboardService",function(e,t){var a=this;e.chartlist=[],t.getMenus({parentId:"0"}).then(function(n){a.menus=n.data,a.menus&&a.menus[0]&&a.menus[0].id&&t.getContent({menuId:a.menus[0].id}).then(function(t){a.dashcontent=_.sortBy(t.data,["picCode"]),_.forEach(a.dashcontent,function(t){var a={};a.opened=!1,a.url=t.url,a.picCode=t.picCode,e.chartlist.push(a)})})}),t.getEcoData({picCode:7117}).then(function(e){a.ecoData=e.data}),t.getEcoData({picCode:7118}).then(function(e){a.ecoDataDown=e.data}),e.open=function(t){e.chartlist[t].opened=!0},e.changed=function(t){if(!angular.isDate(e.chartlist[t].model)||isNaN(e.chartlist[t].model.getTime()))return void alert("请输入正确的日期格式！")},e.altInputFormats=["M!/d!/yyyy"],Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e}}]),e.factory("dashboardService",["$http","URL",function(e,t){function a(a){return e.get(t+"/main/menu",{params:a})}function n(a,n){return e.get(t+a,{params:n})}function r(a){return e.get(t+"/main/showPics",{params:a})}function o(e,t){var a=angular.copy(e);return angular.isDate(a)&&!isNaN(a.getTime())?a.Format(t):""}function i(a){return e.get(t+"/identity/table",{params:a})}return{getMenus:a,getDetail:n,getContent:r,getDateFormat:o,getEcoData:i}}]),e.directive("dashChartEtotal",["dashboardService","$window",function(e,t){return{restrict:"ACE",scope:{econtent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(a,n,r){var o=null;console.log(a.econtent),a.econtent&&a.econtent.url&&e.getDetail(a.econtent.url,{queryTime:e.getDateFormat(a.econtent.model,a.econtent.format),picCode:a.econtent.picCode}).then(function(e){var r=e.data;if(r&&r.series){a.econtent.model||""==r.init_query_time||(a.econtent.model=new Date(r.init_query_time)),a.econtent.query_time=r.init_query_time,a.econtent.dep_name=r.dep_name;var i={};i.formatYear="yyyy","year"==r.time_scope&&(a.econtent.format="yyyy",i.minMode="year",i.datepickerMode="year"),"month"==r.time_scope&&(a.econtent.format="yyyy-MM",i.minMode="month",i.datepickerMode="month"),a.econtent.dateOptions=i,_.forEach(r.series[1].data,function(e){}),r.series[1].data[0].labelLine={normal:{length:24,length2:8}};var l=["rgb(0,204,200)","rgb(240,119,129)","rgb(0,168,228)"],s={color:l,tooltip:{trigger:"item",formatter:function(e){var t=e.data.name+"<br/>";if(e.data.other&&e.data.other.length>1)for(var a=0;a<e.data.other.length;a++)t+=e.data.other[a].name+":"+e.data.other[a].value+e.data.other[a].unit+"<br/>";else t=e.data.name+":"+e.data.value+"<br/>",r.auto_count&&"percent"==r.auto_count&&(t+="占比："+e.percent+"%");return t}},series:[{name:r.series[0].name,type:"pie",selectedMode:"single",radius:[0,"25%"],label:{normal:{position:"center",formatter:"{b}\n {c}亿元",textStyle:{color:"#FFF"}}},labelLine:{normal:{show:!1}},itemStyle:{normal:{color:"rgba(255,255,255,0)"}},data:r.series[0].data},{name:r.series[1].name,type:"pie",label:{normal:{formatter:function(e){var t="\n\n"+e.data.name+"\n";if(e.data.other&&e.data.other.length>1)for(var a=0;a<e.data.other.length;a++)t+=e.data.other[a].name+":"+e.data.other[a].value+e.data.other[a].unit+"\n";else t=e.data.name+":"+e.data.value+"\n",r.auto_count&&"percent"==r.auto_count&&(t+="占比："+e.percent+"%");return t},textStyle:{fontSize:8}}},labelLine:{normal:{length:10,length2:0}},radius:["25%","50%"],data:r.series[1].data}]};o=echarts.init(n.find("div")[0]),o.setOption(s),a.onResize1=function(){o&&o.resize()},angular.element(t).bind("resize",function(){a.onResize1()})}})}}}]),e.directive("dashChartIncrease",["dashboardService","$window",function(e,t){return{restrict:"ACE",scope:{icontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(a,n,r){var o=null;a.icontent&&a.icontent.url&&e.getDetail(a.icontent.url,{queryTime:e.getDateFormat(a.icontent.model,a.icontent.format),picCode:a.icontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){a.icontent.query_time=r.init_query_time,a.icontent.dep_name=r.dep_name;var i=["rgb(0,204,200)","rgb(232,175,64)","rgb(0,168,228)"],l={color:i,tooltip:{trigger:"item",formatter:function(e){var t=e.data.name+"<br/>";if(e.data.other&&e.data.other.length>1)for(var a=0;a<e.data.other.length;a++)t+=e.data.other[a].name+":"+e.data.other[a].value+e.data.other[a].unit+"<br/>";else t=e.data.name+":"+e.data.value+e.data.unit+"<br/>",r.auto_count&&"percent"==r.auto_count&&(t+="占比："+e.percent+"%");return t}},series:[{name:r.series[0].name,type:"pie",selectedMode:"single",radius:[0,"25%"],label:{normal:{position:"center",formatter:function(e){return e.data.name+"\n"+e.data.value+e.data.unit+"\n"},textStyle:{color:"#FFF"}}},labelLine:{normal:{show:!1}},itemStyle:{normal:{color:"rgba(255,255,255,0)"}},data:r.series[0].data},{name:r.series[1].name,type:"pie",label:{normal:{formatter:function(e){var t="\n\n"+e.data.name+"\n";if(e.data.other&&e.data.other.length>1)for(var a=0;a<e.data.other.length;a++)t+=e.data.other[a].name+"\n"+e.data.other[a].value+e.data.other[a].unit+"\n";else t=e.data.name+"\n"+e.data.value+e.data.unit+"\n",r.auto_count&&"percent"==r.auto_count&&(t+="占比："+e.percent+"%");return t}}},radius:["25%","50%"],data:r.series[1].data}]};o=echarts.init(n.find("div")[0]),o.setOption(l),a.onResize2=function(){o&&o.resize()},angular.element(t).bind("resize",function(){a.onResize2()})}})}}}]),e.directive("dashChartInvest",["dashboardService","$window",function(e,t){return{restrict:"ACE",scope:{vcontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(a,n,r){var o=null;a.vcontent&&a.vcontent.url&&e.getDetail(a.vcontent.url,{queryTime:e.getDateFormat(a.vcontent.model,a.vcontent.format),picCode:a.vcontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){a.vcontent.query_time=r.init_query_time,a.vcontent.dep_name=r.dep_name;var i={},l={};r.dataItems&&r.dataItems[0]&&(i=r.dataItems[0]),r.dataItems&&r.dataItems[1]&&(l=r.dataItems[1]);var s=[];_.forEach(r.x_data,function(e,t){var a={};a.name=e;var n=_.map(r.series[0].data,"value"),o=Number(r.series[0].data[0].value[t]);_.forEach(n,function(e,a){Number(r.series[0].data[a].value[t])>o&&(o=Number(r.series[0].data[a].value[t]))}),a.max=o+100,s.push(a)});var c=["rgb(232, 215, 64)","rgb(154, 253, 138)","rgb(14, 83, 108)","rgb(0,204,200)"],u=["rgba(232, 215, 64, 0.5)","rgba(154, 253, 138, 0.5)","rgba(14, 83, 108, 0.5)","rgba(0,204,200,0.5)"];_.forEach(r.series[0].data,function(e,t){e.itemStyle={normal:{color:c[t],borderType:"dashed"}},e.areaStyle={normal:{opacity:.9,color:u[t]}}});var d={tooltip:{},title:{text:i.name+"："+i.value+i.unit,subtext:l.name+"："+l.value+l.unit,textStyle:{fontSize:12,color:c[3]},subtextStyle:{fontSize:12,color:c[3],fontWeight:"border"},itemGap:10,padding:4,backgroundColor:"rgba(0, 120, 215, 0.5)"},legend:{orient:"vertical",left:"right",data:r.legend,textStyle:{color:"#d5e2df"}},radar:{indicator:s,radius:"68%",name:{formatter:"{value}",textStyle:{color:"#d5e2df"}}},series:[{name:r.title,type:"radar",symbol:"circle",symbolSize:2,areaStyle:{normal:{}},data:r.series[0].data}]};o=echarts.init(n.find("div")[0]),o.setOption(d),a.onResize3=function(){o&&o.resize()},angular.element(t).bind("resize",function(){a.onResize3()})}})}}}]),e.directive("dashChartCpi",["dashboardService","$window",function(e,t){return{restrict:"ACE",scope:{ccontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(a,n,r){var o=null;a.ccontent&&a.ccontent.url&&e.getDetail(a.ccontent.url,{queryTime:e.getDateFormat(a.ccontent.model,a.ccontent.format),picCode:a.ccontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){a.ccontent.query_time=r.init_query_time,a.ccontent.dep_name=r.dep_name,_.forEach(r.series,function(e){e.label={normal:{show:!0,position:"top"}}});var i=["rgb(255,169,34)","rgb(0,152,72)","rgb(0,168,228)","rgba(0, 120, 215, 0.6)","rgba(0, 120, 215, 0.06)"],l={color:i,tooltip:{trigger:"axis"},legend:{top:"bottom",data:r.legend,textStyle:{color:"#d5e2df"}},grid:{right:"3%"},xAxis:{type:"category",boundaryGap:!1,data:r.x_data,axisLine:{lineStyle:{color:i[2],shadowColor:i[2],shadowBlur:4}},axisLable:{textStyle:{fontSize:8}},splitLine:{show:!0,interval:"auto",lineStyle:{color:i[3]}},splitArea:{show:!0,areaStyle:{color:i[4]}}},yAxis:{type:"value",axisLabel:{formatter:"{value}"},axisLine:{lineStyle:{color:i[2],shadowColor:i[2],shadowBlur:4}},splitLine:{show:!0,interval:"auto",lineStyle:{color:i[3]}},splitArea:{show:!0,areaStyle:{color:i[4]}}},series:r.series};o=echarts.init(n.find("div")[0]),o.setOption(l),a.onResize4=function(){o&&o.resize()},angular.element(t).bind("resize",function(){a.onResize4()})}})}}}]),e.directive("dashChartConsume",["dashboardService","$window",function(e,t){return{restrict:"ACE",scope:{scontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(a,n,r){var o=null;a.scontent&&a.scontent.url&&e.getDetail(a.scontent.url,{queryTime:e.getDateFormat(a.scontent.model,a.scontent.format),picCode:a.scontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){a.scontent.query_time=r.init_query_time,a.scontent.dep_name=r.dep_name;var i={},l={};r.dataItems&&r.dataItems[0]&&(i=r.dataItems[0]),r.dataItems&&r.dataItems[1]&&(l=r.dataItems[1]);var s=["rgb(107,217,95)","rgb(0,168,228)","rgb(14, 83, 108)","rgb(0,204,200)"],c={color:s,tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},title:{text:i.name+"："+i.value+i.unit,subtext:l.name+"："+l.value+l.unit,left:"right",textStyle:{fontSize:12,color:s[3]},subtextStyle:{fontSize:12,color:s[3],fontWeight:"border"},itemGap:10,padding:4,backgroundColor:"rgba(0, 120, 215, 0.5)"},series:[{name:r.series[0].name,type:"pie",radius:"55%",center:["50%","50%"],startAngle:-230,data:r.series[0].data,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},itemStyle:{normal:{label:{show:!0,formatter:function(e){var t="\n";if(e.data.other&&e.data.other.length>1)for(var a=0;a<e.data.other.length;a++)t+=e.data.other[a].name+":"+e.data.other[a].value+"\n";else t=e.data.name+":"+e.data.value+"\n",r.auto_count&&"percent"==r.auto_count&&(t+="占比："+e.percent+"%");return t}}},labelLine:{show:!0}}}]};o=echarts.init(n.find("div")[0]),o.setOption(c),a.onResize5=function(){o&&o.resize()};var u=$(".dashboard")[0].scrollHeight;$(".dashboard").css({height:u+"px"}),angular.element(t).bind("resize",function(){a.onResize5()})}})}}}])}(),function(){var e=angular.module("app.file",[]);e.controller("fileController",["$scope","fileService","$state","$stateParams","$uibModal","URL",function(e,t,a,n,r,o){function i(){t.getFileList(n.furl,{fileType:"pdf",offset:(l.Paging.currentPage-1)*l.Paging.itemsPerPage,limit:l.Paging.itemsPerPage}).then(function(e){l.fileList=e.data.data,l.Paging.totalItems=e.data.total})}var l=this;e.Modal={},l.Paging={},l.Paging.currentPage=1,l.Paging.maxSize=5,l.Paging.itemsPerPage=10,i(),l.showDetail=function(t,a){var n=r.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"fileDetail.html",scope:e,size:"lg"});e.file_url=o+t+"?id="+a,e.Modal.close=function(){n.close()}},l.Paging.pageChanged=function(){i()}}]),e.filter("trustUrl",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),e.factory("fileService",["$http","URL",function(e,t){function a(a){return e.get(t+"/main/menu",{params:a})}function n(a,n){return e.get(t+a,{params:n})}return{getMenus:a,getFileList:n}}])}(),function(){var e=angular.module("app.login",["ngCookies"]);e.controller("loginController",["$rootScope","$cookies","$scope","$state","loginService",function(e,t,a,n,r){sessionStorage.token&&sessionStorage.removeItem("token"),sessionStorage.message&&(a.alerts=[{type:"danger",msg:sessionStorage.message}],a.closeAlert=function(e){a.alerts.splice(e,1)},sessionStorage.removeItem("message")),a.Login={},a.Login.submit=function(o){if(console.log(o),a.loginSubmitted=!1,o){var i=a.Login.username,l=hex_md5(a.Login.password);r.login({username:i,password:l}).then(function(r){var o=r.data.body[0];e.User=o,t.put("User",JSON.stringify(o)),console.log(JSON.stringify(o));var i=r.data.head.token;i&&(sessionStorage.token=i),200==r.data.head.status?n.go("main.preview"):a.loginError=!0})}else a.loginSubmitted=!0}}]),e.factory("loginService",["$http","URL",function(e,t){function a(a){return e.post(t+"/login",{data:a})}return{login:a}}])}(),function(){var e=angular.module("app.main",[]);e.controller("mainController",["$scope","mainService","$state","$stateParams",function(e,t,a,n){var r=this;t.getMenus({parentId:"0"}).then(function(e){r.menus=e.data,0==n.typeid?a.go("main.preview",{preid:n.mid}):2==n.typeid?a.go("main.file",{furl:n.murl}):a.go("main.module",{id:n.mid})})}]),e.factory("mainService",["$http","URL",function(e,t){function a(a){return e.get(t+"/main/menu",{params:a})}return{getMenus:a}}])}(),function(){var e=angular.module("app.main.module",[]);e.controller("moduleController",["$scope","moduleService","$stateParams","$state",function(e,t,a,n){var r=this;""!=a.url?n.go("main.module.file",{furl:a.url}):t.getMenuTabs({parentId:a.id}).then(function(e){r.menuTabs=e.data,r.menuTabs&&r.menuTabs[0]&&r.menuTabs[0].id&&n.go("main.module.content",{tid:r.menuTabs[0].id})})}]),e.factory("moduleService",["$http","URL",function(e,t){function a(a){return e.get(t+"/main/menu",{params:a})}return{getMenuTabs:a}}])}(),function(){var e=angular.module("app.main.preview",["ui.bootstrap"]);e.controller("previewController",["$scope","previewService","$stateParams","$state",function(e,t,a,n){var r=this;e.chartlist=[],t.getContent({menuId:a.preid}).then(function(t){r.content=_.sortBy(t.data,["picCode"]),_.forEach(r.content,function(t){var a={};a.opened=!1,a.url=t.url,a.picCode=t.picCode,e.chartlist.push(a)})}),t.getEcoData({picCode:7117}).then(function(e){r.ecoData=e.data}),t.getEcoData({picCode:7118}).then(function(e){r.ecoDataDown=e.data}),e.open=function(t){e.chartlist[t].opened=!0},e.changed=function(t){if(!angular.isDate(e.chartlist[t].model)||isNaN(e.chartlist[t].model.getTime()))return void alert("请输入正确的日期格式！")},e.altInputFormats=["M!/d!/yyyy"],Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e}}]),e.factory("previewService",["$http","URL",function(e,t){function a(a,n){return e.get(t+a,{params:n})}function n(a){return e.get(t+"/main/showPics",{params:a})}function r(e,t){var a=angular.copy(e);return angular.isDate(a)&&!isNaN(a.getTime())?a.Format(t):""}function o(a){return e.get(t+"/identity/table",{params:a})}return{getDetail:a,getContent:n,getDateFormat:r,getEcoData:o}}]),e.directive("wiservChartEtotal",["previewService","$window",function(e,t){return{restrict:"ACE",scope:{econtent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(a,n,r){var o=null;a.econtent&&a.econtent.url&&e.getDetail(a.econtent.url,{queryTime:e.getDateFormat(a.econtent.model,a.econtent.format),picCode:a.econtent.picCode}).then(function(e){var r=e.data;if(r&&r.series){a.econtent.model||""==r.init_query_time||(a.econtent.model=new Date(r.init_query_time)),a.econtent.query_time=r.init_query_time;var i={};i.formatYear="yyyy","year"==r.time_scope&&(a.econtent.format="yyyy",i.minMode="year",i.datepickerMode="year"),"month"==r.time_scope&&(a.econtent.format="yyyy-MM",i.minMode="month",i.datepickerMode="month"),a.econtent.dateOptions=i,a.econtent.dep_name=r.dep_name,r.series[1].data[0].labelLine={normal:{length:24,length2:8}};var l=["rgb(0,204,200)","rgb(240,119,129)","rgb(0,168,228)"],s={color:l,tooltip:{trigger:"item",formatter:function(e){var t=e.data.name+"<br/>";if(e.data.other&&e.data.other.length>1)for(var a=0;a<e.data.other.length;a++)t+=e.data.other[a].name+":"+e.data.other[a].value+e.data.other[a].unit+"<br/>";else t=e.data.name+":"+e.data.value+"<br/>",r.auto_count&&"percent"==r.auto_count&&(t+="占比："+e.percent+"%");return t}},series:[{name:r.series[0].name,type:"pie",selectedMode:"single",radius:[0,"25%"],label:{normal:{position:"center",formatter:"{b}\n {c}亿",textStyle:{color:"#333"}}},labelLine:{normal:{show:!1}},itemStyle:{normal:{color:"#FFF"}},data:r.series[0].data},{name:r.series[1].name,type:"pie",label:{normal:{formatter:function(e){var t="\n\n"+e.data.name+"\n";if(e.data.other&&e.data.other.length>1)for(var a=0;a<e.data.other.length;a++)t+=e.data.other[a].name+":"+e.data.other[a].value+e.data.other[a].unit+"\n";else t=e.data.name+":"+e.data.value+"\n",r.auto_count&&"percent"==r.auto_count&&(t+="占比："+e.percent+"%");return t},textStyle:{fontSize:"8"}}},labelLine:{normal:{length:10,length2:0}},radius:["25%","50%"],data:r.series[1].data}]};o=echarts.init(n.find("div")[0]),o.setOption(s),a.onResize1=function(){o&&o.resize()},angular.element(t).bind("resize",function(){a.onResize1()})}})}}}]),e.directive("wiservChartIncrease",["previewService","$window",function(e,t){return{restrict:"ACE",scope:{icontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(a,n,r){var o=null;a.icontent&&a.icontent.url&&e.getDetail(a.icontent.url,{queryTime:e.getDateFormat(a.icontent.model,a.icontent.format),picCode:a.icontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){a.icontent.query_time=r.init_query_time,a.icontent.dep_name=r.dep_name;var i=["rgb(0,204,200)","rgb(232,175,64)","rgb(0,168,228)"],l={color:i,tooltip:{trigger:"item",formatter:function(e){var t=e.data.name+"<br/>";if(e.data.other&&e.data.other.length>1)for(var a=0;a<e.data.other.length;a++)t+=e.data.other[a].name+":"+e.data.other[a].value+e.data.other[a].unit+"<br/>";else t=e.data.name+":"+e.data.value+e.data.unit+"<br/>",r.auto_count&&"percent"==r.auto_count&&(t+="占比："+e.percent+"%");return t}},series:[{name:r.series[0].name,type:"pie",selectedMode:"single",radius:[0,"25%"],label:{normal:{position:"center",formatter:function(e){return e.data.name+"\n"+e.data.value+e.data.unit+"\n"},textStyle:{color:"#333"}}},labelLine:{normal:{show:!1}},itemStyle:{normal:{color:"#FFF"}},data:r.series[0].data},{name:r.series[1].name,type:"pie",label:{normal:{formatter:function(e){var t="\n\n"+e.data.name+"\n";if(e.data.other&&e.data.other.length>1)for(var a=0;a<e.data.other.length;a++)t+=e.data.other[a].name+"\n"+e.data.other[a].value+e.data.other[a].unit+"\n";else t=e.data.name+"\n"+e.data.value+e.data.unit+"\n",r.auto_count&&"percent"==r.auto_count&&(t+="占比："+e.percent+"%");return t}}},radius:["25%","50%"],data:r.series[1].data}]};o=echarts.init(n.find("div")[0]),o.setOption(l),a.onResize2=function(){o&&o.resize()},angular.element(t).bind("resize",function(){a.onResize2()})}})}}}]),e.directive("wiservChartInvest",["previewService","$window",function(e,t){return{restrict:"ACE",scope:{vcontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(a,n,r){var o=null;a.vcontent&&a.vcontent.url&&e.getDetail(a.vcontent.url,{queryTime:e.getDateFormat(a.vcontent.model,a.vcontent.format),picCode:a.vcontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){a.vcontent.query_time=r.init_query_time,a.vcontent.dep_name=r.dep_name;var i={},l={};r.dataItems&&r.dataItems[0]&&(i=r.dataItems[0]),r.dataItems&&r.dataItems[1]&&(l=r.dataItems[1]);var s=[];_.forEach(r.x_data,function(e,t){var a={};a.name=e;var n=_.map(r.series[0].data,"value"),o=Number(r.series[0].data[0].value[t]);_.forEach(n,function(e,a){Number(r.series[0].data[a].value[t])>o&&(o=Number(r.series[0].data[a].value[t]))}),a.max=o+100,s.push(a)});var c=["rgb(232, 215, 64)","rgb(154, 253, 138)","rgb(14, 83, 108)"],u=["rgba(232, 215, 64, 0.5)","rgba(154, 253, 138, 0.5)","rgba(14, 83, 108, 0.5)"];_.forEach(r.series[0].data,function(e,t){e.itemStyle={normal:{color:c[t],borderType:"dashed"}},e.areaStyle={normal:{opacity:.9,color:u[t]}}});var d={tooltip:{},title:{text:i.name+"："+i.value+i.unit,subtext:l.name+"："+l.value+l.unit,textStyle:{fontSize:12},subtextStyle:{fontSize:12,color:"#333",fontWeight:"border"},itemGap:10,padding:4,borderColor:"#DDD",borderWidth:1},legend:{orient:"vertical",left:"right",data:r.legend},radar:{indicator:s,name:{formatter:"{value}",textStyle:{color:"#333"}}},series:[{name:r.title,type:"radar",symbol:"circle",symbolSize:2,areaStyle:{normal:{}},data:r.series[0].data}]};o=echarts.init(n.find("div")[0]),o.setOption(d),a.onResize3=function(){o&&o.resize()},angular.element(t).bind("resize",function(){a.onResize3()})}})}}}]),e.directive("wiservChartCpi",["previewService","$window",function(e,t){return{restrict:"ACE",scope:{ccontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(a,n,r){var o=null;a.ccontent&&a.ccontent.url&&e.getDetail(a.ccontent.url,{queryTime:e.getDateFormat(a.ccontent.model,a.ccontent.format),picCode:a.ccontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){a.ccontent.dep_name=r.dep_name,a.ccontent.query_time=r.init_query_time;var i=["rgb(255,169,34)","rgb(0,152,72)","rgb(0,168,228)"],l={color:i,tooltip:{trigger:"axis"},legend:{top:"bottom",data:r.legend},grid:{right:"3%"},xAxis:{type:"category",boundaryGap:!1,data:r.x_data,axisLable:{textStyle:{fontSize:8}}},yAxis:{type:"value",axisLabel:{formatter:"{value}"}},series:r.series};o=echarts.init(n.find("div")[0]),o.setOption(l),a.onResize4=function(){o&&o.resize()},angular.element(t).bind("resize",function(){a.onResize4()})}})}}}]),e.directive("wiservChartConsume",["previewService","$window",function(e,t){return{restrict:"ACE",scope:{scontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(a,n,r){var o=null;a.scontent&&a.scontent.url&&e.getDetail(a.scontent.url,{queryTime:e.getDateFormat(a.scontent.model,a.scontent.format),picCode:a.scontent.picCode}).then(function(e){var r=e.data;if(a.scontent.query_time=r.init_query_time,a.scontent.dep_name=r.dep_name,r&&r.series){var i={},l={};r.dataItems&&r.dataItems[0]&&(i=r.dataItems[0]),r.dataItems&&r.dataItems[1]&&(l=r.dataItems[1]);var s=["rgb(107,217,95)","rgb(0,168,228)"],c={color:s,tooltip:{trigger:"item",formatter:function(e){var t=e.data.name+"<br/>";if(e.data.other&&e.data.other.length>1)for(var a=0;a<e.data.other.length;a++)t+=e.data.other[a].name+":"+e.data.other[a].value+"<br/>";else t=e.data.name+":"+e.data.value+"<br/>",r.auto_count&&"percent"==r.auto_count&&(t+="占比："+e.percent+"%");return t}},title:{text:i.name+"："+i.value+i.unit,subtext:l.name+"："+l.value+l.unit,left:"right",textStyle:{fontSize:12},subtextStyle:{fontSize:12,color:"#333",fontWeight:"border"},itemGap:10,padding:4,borderColor:"#DDD",borderWidth:1},series:[{name:r.series[0].name,type:"pie",radius:"55%",center:["50%","50%"],startAngle:-230,data:r.series[0].data,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},itemStyle:{normal:{label:{show:!0,formatter:function(e){var t="";if(e.data.other&&e.data.other.length>1)for(var a=0;a<e.data.other.length;a++)t+=e.data.other[a].name+":"+e.data.other[a].value+"\n";else t=e.data.name+":"+e.data.value+"\n",r.auto_count&&"percent"==r.auto_count&&(t+="占比："+e.percent+"%");return t}}},labelLine:{show:!0}}}]};o=echarts.init(n.find("div")[0]),o.setOption(c),a.onResize5=function(){o&&o.resize()},angular.element(t).bind("resize",function(){a.onResize5()})}})}}}])}(),function(){var e=angular.module("app.main.module.content",[]);e.controller("contentController",["$scope","contentService","$stateParams","$state",function(e,t,a,n){var r=this;t.getSubMenus({parentId:a.tid}).then(function(e){r.subMenus=e.data,r.subMenus&&r.subMenus[0]&&r.subMenus[0].id&&n.go("main.module.content.detail",{pid:r.subMenus[0].id})})}]),e.factory("contentService",["$http","URL",function(e,t){function a(a){return e.get(t+"/main/menu",{params:a})}return{getSubMenus:a}}])}(),function(){var e=angular.module("app.main.module.content.detail",["ui.bootstrap"]);e.controller("detailController",["$scope","detailService","$stateParams","uibDateParser",function(e,t,a,n){var r=this;e.popups=[],e.quarterOptions=[{id:3,name:"第一季度"},{id:6,name:"第二季度"},{id:9,name:"第三季度"},{id:12,name:"第四季度"}],t.getContent({menuId:a.pid}).then(function(t){r.dcontent=_.sortBy(t.data,["picCode"]),_.forEach(r.dcontent,function(t){var a={};a.opened=!1,a.url=t.url,a.picCode=t.picCode,e.popups.push(a)})}),e.open=function(t){e.popups[t].opened=!0},e.changed=function(t){return!angular.isDate(e.popups[t].model)||isNaN(e.popups[t].model.getTime())?void alert("请输入正确的日期格式！"):"quarter"!=e.popups[t].time_scope||e.popups[t].quarter?void 0:void alert("请选择季度！")},e.altInputFormats=["M!/d!/yyyy"],Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e}}]),e.factory("detailService",["$http","URL",function(e,t){function a(a){return e.get(t+"/main/showPics",{params:a})}function n(a,n){return e.get(t+a,{params:n})}function r(a,n){return e.get(t+a,{params:n})}return{getContent:a,getDetail:n,getTableData:r}}]),e.directive("wiservChart",["detailService","$window",function(e,t){return{restrict:"ACE",scope:{content:"="},template:"<div style='width:100%;height:100%'></div>",link:function(a,n,r){function o(e,t){var a=angular.copy(e);return angular.isDate(a)&&!isNaN(a.getTime())?a.Format(t):""}function i(){var t=angular.copy(a.content.model),r=angular.copy(a.content.format);a.content.model&&"quarter"==a.content.time_scope&&(t.setMonth(a.content.quarter-1),r="yyyy-MM"),e.getDetail(a.content.url,{queryTime:o(t,r),picCode:a.content.picCode}).then(function(i){var c=i.data;if(c&&c.series&&c.series[0]){if(!a.content.model&&""!=c.init_query_time&&(a.content.model=new Date(c.init_query_time),!a.content.quarter)){var u=c.init_query_time.substring(c.init_query_time.indexOf("-")+1);a.content.quarter=Number(u)}a.content.dep_name=c.dep_name,a.content.time_scope=c.time_scope;var d={};d.formatYear="yyyy","year"==c.time_scope&&(a.content.format="yyyy",d.minMode="year",d.datepickerMode="year"),"month"==c.time_scope&&(a.content.format="yyyy-MM",d.minMode="month",d.datepickerMode="month"),"quarter"==c.time_scope&&(a.content.format="yyyy",d.minMode="year",d.datepickerMode="year"),a.content.dateOptions=d,c.yAxis=[],_.forEach(c.y_name,function(e,t){var a={};a.type="value",a.name=e,a.axisTick={},a.axisTick.inside=!0,c.max_and_min&&(a.min=Math.round(c.max_and_min[t].minValue),a.max=Math.round(c.max_and_min[t].maxValue)),c.yAxis.push(a)});var m=["rgb(91,192,222)","rgb(0,215,185)","rgb(221,127,141)","rgb(71,190,121)"],p=["#FFF","rgb(46,200,202)","rgb(221,127,141)","rgb(49,167,229)"];if("pie"==c.series[0].type)s.series=c.series,1==s.series.length&&(p=m),s.color=p,c.series.length>1&&(s.series[0].radius=[0,"26%"],s.series[1].label={},s.series[1].label.normal={},s.series[1].label.normal.formatter=function(e){var t="\n\n"+e.data.name+"\n";if(e.data.other&&e.data.other.length>1)for(var a=0;a<e.data.other.length;a++)t+=e.data.other[a].name+":"+e.data.other[a].value+"\n";else t=e.data.name+":"+e.data.value+"\n",c.auto_count&&"percent"==c.auto_count&&(t+="占比："+e.percent+"%");return t},s.series[1].radius=["26%","48%"]),s.tooltip={trigger:"item",formatter:function(e){var t=e.data.name+"<br/>";if(e.data.other&&e.data.other.length>1)for(var a=0;a<e.data.other.length;a++)t+=e.data.other[a].name+":"+e.data.other[a].value+"<br/>";else t=e.data.name+":"+e.data.value+"\n",c.auto_count&&"percent"==c.auto_count&&(t+="占比："+e.percent+"%");return t}},s.title={text:c.title,left:"center"},s.series[0].label={},s.series[0].label.normal={},s.series[0].label.normal.position="center",1==s.series.length&&(s.series[0].label.normal.position="outside"),s.series[0].label.normal.formatter="{b}\n {c}"+c.y_name[0],s.series[0].label.normal.textStyle={color:"#333"};else if("radar"==c.series[0].type){var h=[];_.forEach(c.x_data,function(e,t){var a={};a.name=e;var n=_.map(c.series[0].data,"value"),r=Number(c.series[0].data[0].value[t]);_.forEach(n,function(e,a){Number(c.series[0].data[a].value[t])>r&&(r=Number(c.series[0].data[a].value[t]))}),a.max=r+100,h.push(a)}),s.color=m,s.tooltip={},s.title={text:c.title,left:"center"},s.radar={},s.radar.indicator=h,s.series=c.series}else{var g="",f="top",v={},y=60;"1"==c.need_group&&(g="group",f="inside"),c.series[0].data.length>10&&(v={interval:0,formatter:function(e){return e.indexOf("月")>-1?e:e.split("").join("\n")}}),_.forEach(c.series,function(e){if(e.label={normal:{show:!0,normal:{position:f,textStyle:{color:"#333",fontSize:12}}}},"bar"==e.type&&(e.data.length<3?e.barMaxWidth="20%":(e.barMaxWidth="40%",e.data.length>10&&(e.label={normal:{show:!1}}))),"line"==e.type){var t=_.map(e.data,"name");t&&t.length>1&&1==_.uniq(t).length&&(e.symbol="roundCircle",e.symbolSize=1,_.forEach(e.data,function(e,t){0==t?e.label={normal:{show:!0,textStyle:{color:m[2]}}}:e.label={normal:{show:!1,textStyle:{color:m[2]}}}}))}e.data.length>5&&_.forEach(e.data,function(t){t.name&&t.name.length>5&&e.data.length>12&&(y=150)}),e.connectNulls=!0,e.stack=g}),s={color:m,
title:{text:c.title,left:"center"},tooltip:{trigger:"axis"},legend:{top:"bottom",bottom:20,data:c.legend},grid:{bottom:y},xAxis:[{type:"category",axisTick:{show:!1},axisLabel:v,data:c.x_data}],yAxis:c.yAxis,series:c.series}}if("same"==c.table_type){a.content.columnNames=c.x_data;var b=[];"radar"==c.series[0].type?_.forEach(c.series[0].data,function(e,t){var a={};a.rowName=e.name;var n=[];_.forEach(e.value,function(e){var t={};t.value=e,n.push(t)}),a.rowValue=n,b.push(a)}):_.forEach(c.legend,function(e,t){var a={};a.rowName=e,a.rowValue=c.series[t].data,b.push(a)}),a.content.rowData=b}else if("reverse"==c.table_type){a.content.columnNames=c.legend;var b=[];_.forEach(c.x_data,function(e,t){var a={};a.rowName=e;var n=[];"radar"==c.series[0].type?_.forEach(c.series[0].data,function(e,a){var r={};r.name=e.name,r.value=e.value[t],n.push(r)}):_.forEach(c.series,function(e,a){var r={};r.name=e.name,r.value=c.series[a].data[t].value,n.push(r)}),a.rowValue=n,b.push(a)}),a.content.rowData=b}else"form"==c.table_type?(a.content.formTable=!0,e.getTableData(c.table_url,{picCode:a.content.picCode,queryTime:o(t,r)}).then(function(e){a.content.rowData=e.data})):e.getTableData(c.table_url,{picCode:a.content.picCode,queryTime:o(t,r)}).then(function(e){a.content.columnNames=e.data.columnName,a.content.rowData=e.data.rowData});setTimeout(function(){l=echarts.init(n.find("div")[0]),console.log(n.find("div")[0]),console.log($(".graph").height()),l.clear(),l.resize(),l.setOption(s)},300)}})}a.$watch("content.model",function(e,t){e!==t&&e&&t&&i()}),a.$watch("content.quarter",function(e,t){e!==t&&e&&t&&i()});var l=null,s={};i(),a.onResize=function(){l&&l.resize()},angular.element(t).bind("resize",function(){a.onResize()})}}}])}();