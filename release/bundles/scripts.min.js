"use strict";!function(){function e(e,t,n){function a(e,t){return{request:function(e){return e},response:function(t){return e.when(t,function(e){}),t}}}t.otherwise("/dashboard"),e.state("dashboard",{url:"/dashboard",templateUrl:"partials/dashboard/view.html",controller:"dashboardController",controllerAs:"dashboard"}).state("main",{url:"/main/:mid/:typeid",templateUrl:"partials/main/view.html",controller:"mainController",controllerAs:"main"}).state("main.preview",{url:"/preview/:preid",templateUrl:"partials/preview/view.html",controller:"previewController",controllerAs:"preview"}).state("main.module",{url:"/module/:id/:url",templateUrl:"partials/module/view.html",controller:"moduleController",controllerAs:"module"}).state("main.module.file",{url:"/file/:furl",templateUrl:"partials/file/view.html",controller:"fileController",controllerAs:"file"}).state("main.module.content",{url:"/content/:tid",templateUrl:"partials/module/content/view.html",controller:"contentController",controllerAs:"content"}).state("main.module.content.detail",{url:"/detail/:pid",templateUrl:"partials/module/content/detail/view.html",controller:"detailController",controllerAs:"detail"}),n.interceptors.push(a),a.$inject=["$q","$location"]}angular.module("app",["ngAnimate","ui.router","common.http","app.dashboard","app.main","app.file","app.main.preview","app.main.module","app.main.module.content","app.main.module.content.detail"]).config(e),e.$inject=["$stateProvider","$urlRouterProvider","$httpProvider"]}(),function(){var e=angular.module("common.http",[]);e.constant("URL",location.protocol+"//"+location.host),e.factory("validate",[function(){return function(e,t){var n=function(t){return e&&e.head&&e.head.status===t};switch(t){case 200:return n(t);case 201:return n(t);case 202:return n(t);case 400:return n(t);case 404:return n(t);case 405:return n(t);case 415:return n(t);case 500:return n(t)}}}])}(),function(){var e=angular.module("app.dashboard",[]);e.$inject=["$location"],e.controller("dashboardController",["$scope","dashboardService",function(e,t){var n=this;e.chartlist=[],t.getMenus({parentId:"0"}).then(function(a){n.menus=a.data,n.menus&&n.menus[0]&&n.menus[0].id&&t.getContent({menuId:n.menus[0].id}).then(function(t){n.dashcontent=_.sortBy(t.data,["picCode"]),_.forEach(n.dashcontent,function(t){var n={};n.opened=!1,n.url=t.url,n.picCode=t.picCode,e.chartlist.push(n)})})}),e.open=function(t){e.chartlist[t].opened=!0},e.changed=function(t){if(!angular.isDate(e.chartlist[t].model)||isNaN(e.chartlist[t].model.getTime()))return void alert("请输入正确的日期格式！")},e.altInputFormats=["M!/d!/yyyy"],Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e}}]),e.factory("dashboardService",["$http","URL",function(e,t){function n(n){return e.get(t+"/main/menu",{params:n})}function a(n,a){return e.get(t+n,{params:a})}function r(n){return e.get(t+"/main/showPics",{params:n})}function o(e,t){var n=angular.copy(e);return angular.isDate(n)&&!isNaN(n.getTime())?n.Format(t):""}return{getMenus:n,getDetail:a,getContent:r,getDateFormat:o}}]),e.directive("dashChartEtotal",["dashboardService","$window",function(e,t){return{restrict:"ACE",scope:{econtent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(n,a,r){var o=null;e.getDetail(n.econtent.url,{queryTime:e.getDateFormat(n.econtent.model,n.econtent.format),picCode:n.econtent.picCode}).then(function(e){var r=e.data;if(r&&r.series){n.econtent.model||""==r.init_query_time||(n.econtent.model=new Date(r.init_query_time));var i={};i.formatYear="yyyy","year"==r.time_scope&&(n.econtent.format="yyyy",i.minMode="year",i.datepickerMode="year"),"month"==r.time_scope&&(n.econtent.format="yyyy-MM",i.minMode="month",i.datepickerMode="month"),n.econtent.dateOptions=i;var l=["rgb(0,204,200)","rgb(240,119,129)","rgb(0,168,228)"],s={color:l,tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:r.series[0].name,type:"pie",selectedMode:"single",radius:[0,"30%"],label:{normal:{position:"center",formatter:"{b}\n {c}亿",textStyle:{color:l[0]}}},labelLine:{normal:{show:!1}},itemStyle:{normal:{color:"rgba(255,255,255,0)"}},data:r.series[0].data},{name:r.series[1].name,type:"pie",label:{normal:{formatter:function(e){for(var t=e.data.name+"\n",n=0;n<e.data.other.length;n++)t+=e.data.other[n].name+e.data.other[n].value+e.data.other[n].unit+"\n";return t}}},radius:["30%","55%"],data:r.series[1].data}]};o=echarts.init(a.find("div")[0]),o.setOption(s),n.onResize1=function(){o&&o.resize()},angular.element(t).bind("resize",function(){n.onResize1()})}})}}}]),e.directive("dashChartIncrease",["dashboardService","$window",function(e,t){return{restrict:"ACE",scope:{icontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(n,a,r){console.log(n);var o=null;e.getDetail(n.icontent.url,{queryTime:e.getDateFormat(n.icontent.model,n.icontent.format),picCode:n.icontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){var i=["rgb(0,204,200)","rgb(232,175,64)","rgb(0,168,228)"],l={color:i,tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:r.series[0].name,type:"pie",selectedMode:"single",radius:[0,"30%"],label:{normal:{position:"center",formatter:"{b}\n {c}%",textStyle:{color:i[0]}}},labelLine:{normal:{show:!1}},itemStyle:{normal:{color:"rgba(255,255,255,0)"}},data:r.series[0].data},{name:r.series[1].name,type:"pie",label:{normal:{formatter:function(e){for(var t=e.data.name+"\n",n=0;n<e.data.other.length;n++)t+=e.data.other[n].name+e.data.other[n].value+e.data.other[n].unit+"\n";return t}}},radius:["30%","55%"],data:r.series[1].data}]};o=echarts.init(a.find("div")[0]),o.setOption(l),n.onResize2=function(){o&&o.resize()},angular.element(t).bind("resize",function(){n.onResize2()})}})}}}]),e.directive("dashChartInvest",["dashboardService","$window",function(e,t){return{restrict:"ACE",scope:{vcontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(n,a,r){console.log(n);var o=null;e.getDetail(n.vcontent.url,{queryTime:e.getDateFormat(n.vcontent.model,n.vcontent.format),picCode:n.vcontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){var i=[];_.forEach(r.x_data,function(e,t){var n={};n.name=e;var a=_.map(r.series[0].data,"value"),o=r.series[0].data[0].value[t];_.forEach(a,function(e,n){r.series[0].data[n].value[t]>o&&(o=r.series[0].data[n].value[t])}),n.max=o+100,i.push(n)});var l=["rgb(232, 215, 64)","rgb(154, 253, 138)","rgb(14, 83, 108)","rgb(0,204,200)"],s=["rgba(232, 215, 64, 0.5)","rgba(154, 253, 138, 0.5)","rgba(14, 83, 108, 0.5)","rgba(0,204,200,0.5)"];_.forEach(r.series[0].data,function(e,t){e.itemStyle={normal:{color:l[t],borderType:"dashed"}},e.areaStyle={normal:{opacity:.9,color:s[t]}}});var c={tooltip:{},title:{text:"总投资：608.31亿元",subtext:"增速：17.5%",textStyle:{fontSize:12,color:l[3]},subtextStyle:{fontSize:12,color:l[3],fontWeight:"border"},itemGap:10,padding:6,backgroundColor:"rgba(0, 120, 215, 0.5)"},legend:{orient:"vertical",left:"right",data:r.legend},radar:{indicator:i},series:[{name:" 全社会固定资产投资情况",type:"radar",symbol:"circle",symbolSize:2,areaStyle:{normal:{}},data:r.series[0].data}]};o=echarts.init(a.find("div")[0]),o.setOption(c),n.onResize3=function(){o&&o.resize()},angular.element(t).bind("resize",function(){n.onResize3()})}})}}}]),e.directive("dashChartCpi",["dashboardService","$window",function(e,t){return{restrict:"ACE",scope:{ccontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(n,a,r){console.log(n);var o=null;e.getDetail(n.ccontent.url,{queryTime:e.getDateFormat(n.ccontent.model,n.ccontent.format),picCode:n.ccontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){_.forEach(r.series,function(e){e.label={normal:{show:!0,position:"top"}}});var i=["rgb(255,169,34)","rgb(0,152,72)","rgb(0,168,228)","rgba(0, 120, 215, 0.6)","rgba(0, 120, 215, 0.06)"],l={color:i,tooltip:{trigger:"axis"},legend:{top:"bottom",data:r.legend},xAxis:{type:"category",boundaryGap:!1,data:r.x_data,axisLine:{lineStyle:{color:i[2],shadowColor:i[2],shadowBlur:4}},splitLine:{show:!0,interval:"auto",lineStyle:{color:i[3]}},splitArea:{show:!0,areaStyle:{color:i[4]}}},yAxis:{type:"value",axisLabel:{formatter:"{value}"},axisLine:{lineStyle:{color:i[2],shadowColor:i[2],shadowBlur:4}},splitLine:{show:!0,interval:"auto",lineStyle:{color:i[3]}},splitArea:{show:!0,areaStyle:{color:i[4]}}},series:r.series};o=echarts.init(a.find("div")[0]),o.setOption(l),n.onResize4=function(){o&&o.resize()},angular.element(t).bind("resize",function(){n.onResize4()})}})}}}]),e.directive("dashChartConsume",["dashboardService","$window",function(e,t){return{restrict:"ACE",scope:{scontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(n,a,r){console.log(n);var o=null;e.getDetail(n.scontent.url,{queryTime:e.getDateFormat(n.scontent.model,n.scontent.format),picCode:n.scontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){var i=["rgb(107,217,95)","rgb(0,168,228)","rgb(14, 83, 108)","rgb(0,204,200)"],l={color:i,tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},title:{text:"社消零售总额：136.2亿元",subtext:"同比增速：12.9%",textStyle:{fontSize:12,color:i[3]},subtextStyle:{fontSize:12,color:i[3],fontWeight:"border"},itemGap:10,padding:6,backgroundColor:"rgba(0, 120, 215, 0.5)"},series:[{name:r.series[0].name,type:"pie",radius:"55%",center:["50%","50%"],startAngle:-230,data:r.series[0].data,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},itemStyle:{normal:{label:{show:!0,formatter:"{b} : {c}亿 \n占比 :{d}%"}},labelLine:{show:!0}}}]};o=echarts.init(a.find("div")[0]),o.setOption(l),n.onResize5=function(){o&&o.resize()},angular.element(t).bind("resize",function(){n.onResize5()})}})}}}])}(),function(){var e=angular.module("app.file",[]);e.controller("fileController",["$scope","fileService","$state","$stateParams","$uibModal",function(e,t,n,a,r){function o(){t.getFileList(a.furl,{fileType:"pdf",offset:(i.Paging.currentPage-1)*i.Paging.itemsPerPage,limit:i.Paging.itemsPerPage}).then(function(e){i.fileList=e&&e.data?e.data.body[0].data:"",i.Paging.totalItems=e.data.body[0].total})}var i=this;e.Modal={},i.Paging={},i.Paging.currentPage=1,i.Paging.maxSize=5,i.Paging.itemsPerPage=10,o(),i.showDetail=function(t){var n=r.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"fileDetail.html",scope:e,size:"lg"});e.file_url=t,e.Modal.close=function(){n.close()}},i.Paging.pageChanged=function(){o()}}]),e.factory("fileService",["$http","URL",function(e,t){function n(n){return e.get(t+"/main/menu",{params:n})}function a(n,a){return e.get(t+n,{params:a})}return{getMenus:n,getFileList:a}}])}(),function(){var e=angular.module("app.main",[]);e.controller("mainController",["$scope","mainService","$state","$stateParams",function(e,t,n,a){var r=this;t.getMenus({parentId:"0"}).then(function(e){r.menus=e.data,0==a.typeid?n.go("main.preview",{preid:a.mid}):n.go("main.module",{id:a.mid})})}]),e.factory("mainService",["$http","URL",function(e,t){function n(n){return e.get(t+"/main/menu",{params:n})}return{getMenus:n}}])}(),function(){var e=angular.module("app.main.module",[]);e.controller("moduleController",["$scope","moduleService","$stateParams","$state",function(e,t,n,a){var r=this;r.showNav=!1,""!=n.url?a.go("main.module.file",{furl:n.url}):(r.showNav=!0,t.getMenuTabs({parentId:n.id}).then(function(e){r.menuTabs=e.data,r.menuTabs&&r.menuTabs[0]&&r.menuTabs[0].id&&a.go("main.module.content",{tid:r.menuTabs[0].id})}))}]),e.factory("moduleService",["$http","URL",function(e,t){function n(n){return e.get(t+"/main/menu",{params:n})}return{getMenuTabs:n}}])}(),function(){var e=angular.module("app.main.preview",["ui.bootstrap"]);e.controller("previewController",["$scope","previewService","$stateParams","$state",function(e,t,n,a){var r=this;e.chartlist=[],t.getContent({menuId:n.preid}).then(function(t){r.content=_.sortBy(t.data,["picCode"]),_.forEach(r.content,function(t){var n={};n.opened=!1,n.url=t.url,n.picCode=t.picCode,e.chartlist.push(n)})}),e.open=function(t){e.chartlist[t].opened=!0},e.changed=function(t){if(!angular.isDate(e.chartlist[t].model)||isNaN(e.chartlist[t].model.getTime()))return void alert("请输入正确的日期格式！")},e.altInputFormats=["M!/d!/yyyy"],Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e}}]),e.factory("previewService",["$http","URL",function(e,t){function n(n,a){return e.get(t+n,{params:a})}function a(n){return e.get(t+"/main/showPics",{params:n})}function r(e,t){var n=angular.copy(e);return angular.isDate(n)&&!isNaN(n.getTime())?n.Format(t):""}return{getDetail:n,getContent:a,getDateFormat:r}}]),e.directive("wiservChartEtotal",["previewService","$window",function(e,t){return{restrict:"ACE",scope:{econtent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(n,a,r){var o=null;e.getDetail(n.econtent.url,{queryTime:e.getDateFormat(n.econtent.model,n.econtent.format),picCode:n.econtent.picCode}).then(function(e){var r=e.data;if(r&&r.series){n.econtent.model||""==r.init_query_time||(n.econtent.model=new Date(r.init_query_time));var i={};i.formatYear="yyyy","year"==r.time_scope&&(n.econtent.format="yyyy",i.minMode="year",i.datepickerMode="year"),"month"==r.time_scope&&(n.econtent.format="yyyy-MM",i.minMode="month",i.datepickerMode="month"),n.econtent.dateOptions=i;var l=["rgb(0,204,200)","rgb(240,119,129)","rgb(0,168,228)"],s={color:l,tooltip:{trigger:"item",formatter:function(e){for(var t=e.data.name+"<br/>",n=0;n<e.data.other.length;n++)t+=e.data.other[n].name+e.data.other[n].value+"<br/>";return t}},series:[{name:r.series[0].name,type:"pie",selectedMode:"single",radius:[0,"30%"],label:{normal:{position:"center",formatter:"{b}\n {c}亿",textStyle:{color:"#333"}}},labelLine:{normal:{show:!1}},itemStyle:{normal:{color:"#FFF"}},data:r.series[0].data},{name:r.series[1].name,type:"pie",label:{normal:{formatter:function(e){for(var t=e.data.name+"\n",n=0;n<e.data.other.length;n++)t+=e.data.other[n].name+e.data.other[n].value+"\n";return t}}},radius:["30%","55%"],data:r.series[1].data}]};o=echarts.init(a.find("div")[0]),o.setOption(s),n.onResize1=function(){o&&o.resize()},angular.element(t).bind("resize",function(){n.onResize1()})}})}}}]),e.directive("wiservChartIncrease",["previewService","$window",function(e,t){return{restrict:"ACE",scope:{icontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(n,a,r){console.log(n);var o=null;e.getDetail(n.icontent.url,{queryTime:e.getDateFormat(n.icontent.model,n.icontent.format),picCode:n.icontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){var i=["rgb(0,204,200)","rgb(232,175,64)","rgb(0,168,228)"],l={color:i,tooltip:{trigger:"item",formatter:function(e){for(var t=e.data.name+"<br/>",n=0;n<e.data.other.length;n++)t+=e.data.other[n].name+e.data.other[n].value+"<br/>";return t}},series:[{name:r.series[0].name,type:"pie",selectedMode:"single",radius:[0,"30%"],label:{normal:{position:"center",formatter:"{b}\n {c}%",textStyle:{color:"#333"}}},labelLine:{normal:{show:!1}},itemStyle:{normal:{color:"#FFF"}},data:r.series[0].data},{name:r.series[1].name,type:"pie",label:{normal:{formatter:function(e){for(var t=e.data.name+"\n",n=0;n<e.data.other.length;n++)t+=e.data.other[n].name+e.data.other[n].value+e.data.other[n].unit+"\n";return t}}},radius:["30%","55%"],data:r.series[1].data}]};o=echarts.init(a.find("div")[0]),o.setOption(l),n.onResize2=function(){o&&o.resize()},angular.element(t).bind("resize",function(){n.onResize2()})}})}}}]),e.directive("wiservChartInvest",["previewService","$window",function(e,t){return{restrict:"ACE",scope:{vcontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(n,a,r){console.log(n);var o=null;e.getDetail(n.vcontent.url,{queryTime:e.getDateFormat(n.vcontent.model,n.vcontent.format),picCode:n.vcontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){var i=[];_.forEach(r.x_data,function(e,t){var n={};n.name=e;var a=_.map(r.series[0].data,"value"),o=r.series[0].data[0].value[t];_.forEach(a,function(e,n){r.series[0].data[n].value[t]>o&&(o=r.series[0].data[n].value[t])}),n.max=o+100,i.push(n)});var l=["rgb(232, 215, 64)","rgb(154, 253, 138)","rgb(14, 83, 108)"],s=["rgba(232, 215, 64, 0.5)","rgba(154, 253, 138, 0.5)","rgba(14, 83, 108, 0.5)"];_.forEach(r.series[0].data,function(e,t){e.itemStyle={normal:{color:l[t],borderType:"dashed"}},e.areaStyle={normal:{opacity:.9,color:s[t]}}}),console.log(r.series[0].data);var c={tooltip:{},title:{text:"总投资：608.31亿元",subtext:"增速：17.5%",textStyle:{fontSize:12},subtextStyle:{fontSize:12,color:"#333",fontWeight:"border"},itemGap:10,padding:6,borderColor:"#DDD",borderWidth:1},legend:{orient:"vertical",left:"right",data:r.legend},radar:{indicator:i},series:[{name:" 全社会固定资产投资情况",type:"radar",symbol:"circle",symbolSize:2,areaStyle:{normal:{}},data:r.series[0].data}]};o=echarts.init(a.find("div")[0]),o.setOption(c),n.onResize3=function(){o&&o.resize()},angular.element(t).bind("resize",function(){n.onResize3()})}})}}}]),e.directive("wiservChartCpi",["previewService","$window",function(e,t){return{restrict:"ACE",scope:{ccontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(n,a,r){console.log(n);var o=null;e.getDetail(n.ccontent.url,{queryTime:e.getDateFormat(n.ccontent.model,n.ccontent.format),picCode:n.ccontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){var i=["rgb(255,169,34)","rgb(0,152,72)","rgb(0,168,228)"],l={color:i,tooltip:{trigger:"axis"},legend:{top:"bottom",data:r.legend},xAxis:{type:"category",boundaryGap:!1,data:r.x_data},yAxis:{type:"value",axisLabel:{formatter:"{value}"}},series:r.series};o=echarts.init(a.find("div")[0]),o.setOption(l),n.onResize4=function(){o&&o.resize()},angular.element(t).bind("resize",function(){n.onResize4()})}})}}}]),e.directive("wiservChartConsume",["previewService","$window",function(e,t){return{restrict:"ACE",scope:{scontent:"="},template:"<div style='width:100%;height:100%'></div>",link:function(n,a,r){console.log(n);var o=null;e.getDetail(n.scontent.url,{queryTime:e.getDateFormat(n.scontent.model,n.scontent.format),picCode:n.scontent.picCode}).then(function(e){var r=e.data;if(r&&r.series){var i=["rgb(107,217,95)","rgb(0,168,228)"],l={color:i,tooltip:{trigger:"item",formatter:function(e){for(var t=e.data.name+"<br/>",n=0;n<e.data.other.length;n++)t+=e.data.other[n].name+e.data.other[n].value+"<br/>";return t}},title:{text:"社消零售总额：136.2亿元",subtext:"同比增速：12.9%",textStyle:{fontSize:12},subtextStyle:{fontSize:12,color:"#333",fontWeight:"border"},itemGap:10,padding:6,borderColor:"#DDD",borderWidth:1},series:[{name:r.series[0].name,type:"pie",radius:"55%",center:["50%","50%"],startAngle:-230,data:r.series[0].data,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},itemStyle:{normal:{label:{show:!0,formatter:"{b} : {c}亿 \n占比 :{d}%"}},labelLine:{show:!0}}}]};o=echarts.init(a.find("div")[0]),o.setOption(l),n.onResize5=function(){o&&o.resize()},angular.element(t).bind("resize",function(){n.onResize5()})}})}}}])}(),function(){var e=angular.module("app.main.module.content",[]);e.controller("contentController",["$scope","contentService","$stateParams","$state",function(e,t,n,a){var r=this;t.getSubMenus({parentId:n.tid}).then(function(e){r.subMenus=e.data,r.subMenus&&r.subMenus[0]&&r.subMenus[0].id&&a.go("main.module.content.detail",{pid:r.subMenus[0].id})})}]),e.factory("contentService",["$http","URL",function(e,t){function n(n){return e.get(t+"/main/menu",{params:n})}return{getSubMenus:n}}])}(),function(){var e=angular.module("app.main.module.content.detail",["ui.bootstrap"]);e.controller("detailController",["$scope","detailService","$stateParams","uibDateParser",function(e,t,n,a){var r=this;e.popups=[],t.getContent({menuId:n.pid}).then(function(t){r.dcontent=_.sortBy(t.data,["picCode"]),_.forEach(r.dcontent,function(t){var n={};n.opened=!1,n.url=t.url,n.picCode=t.picCode,e.popups.push(n)})}),e.open=function(t){e.popups[t].opened=!0},e.changed=function(t){if(!angular.isDate(e.popups[t].model)||isNaN(e.popups[t].model.getTime()))return void alert("请输入正确的日期格式！")},e.altInputFormats=["M!/d!/yyyy"],Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e}}]),e.factory("detailService",["$http","URL",function(e,t){function n(n){return e.get(t+"/main/showPics",{params:n})}function a(n,a){return e.get(t+n,{params:a})}function r(n,a){return e.get(t+n,{params:a})}return{getContent:n,getDetail:a,getTableData:r}}]),e.directive("wiservChart",["detailService","$window",function(e,t){return{restrict:"ACE",scope:{content:"="},template:"<div style='width:100%;height:100%'></div>",link:function(n,a,r){function o(e,t){var n=angular.copy(e);return angular.isDate(n)&&!isNaN(n.getTime())?n.Format(t):""}function i(){e.getDetail(n.content.url,{queryTime:o(n.content.model,n.content.format),picCode:n.content.picCode}).then(function(t){var r=t.data;if(r&&r.series&&r.series[0]){n.content.model||""==r.init_query_time||(n.content.model=new Date(r.init_query_time));var i={};i.formatYear="yyyy","year"==r.time_scope&&(n.content.format="yyyy",i.minMode="year",i.datepickerMode="year"),"month"==r.time_scope&&(n.content.format="yyyy-MM",i.minMode="month",i.datepickerMode="month"),n.content.dateOptions=i,r.yAxis=[],_.forEach(r.y_name,function(e){var t={};t.type="value",t.name=e,t.axisTick={},t.axisTick.inside=!0,r.yAxis.push(t)});var c=["#0070c0","#20b3a9","#CC6600","#ff0000"];if("pie"==r.series[0].type)s.series=r.series,r.series.length>1&&(s.series[0].radius=[0,"26%"],s.series[1].label={},s.series[1].label.normal={},s.series[1].label.normal.formatter=function(e){console.log(e);var t="\n\n"+e.data.name+"\n";if(e.data.other&&e.data.other.length>1)for(var n=0;n<e.data.other.length;n++)t+=e.data.other[n].name+":"+e.data.other[n].value+"\n";else t=e.data.name+":"+e.data.value;return t},s.series[1].radius=["26%","48%"]),s.tooltip={trigger:"item",formatter:function(e){for(var t=e.data.name+"<br/>",n=0;n<e.data.other.length;n++)t+=e.data.other[n].name+":"+e.data.other[n].value+"<br/>";return t}},s.title={text:r.title,left:"center"},s.series[0].label={},s.series[0].label.normal={},s.series[0].label.normal.position="center",s.series[0].label.normal.formatter="{b}\n {c}"+r.y_name[0],s.series[0].label.normal.textStyle={color:"#FFF"};else if("radar"==r.series[0].type){var d=[];_.forEach(r.x_data,function(e,t){var n={};n.name=e;var a=_.map(r.series[0].data,"value"),o=Number(r.series[0].data[0].value[t]);_.forEach(a,function(e,n){Number(r.series[0].data[n].value[t])>o&&(o=Number(r.series[0].data[n].value[t]))}),console.log(o),n.max=o+100,d.push(n)}),s.tooltip={},s.title={text:r.title,left:"center"},console.log(d),s.radar={},s.radar.indicator=d,s.series=r.series}else{var u="",m="top";"1"==r.need_group&&(u="group",m="inside"),_.forEach(r.series,function(e){console.log(e),e.data.length>5&&$(".box-wrap").css({"-webkit-flex-flow":"column","flex-flow":"column"});var t={normal:{show:!0,position:m,textStyle:{color:"#333",fontSize:12}}};e.label=t,e.stack=u}),s={color:c,title:{text:r.title,left:"center"},tooltip:{trigger:"axis"},legend:{top:"bottom",bottom:20,data:r.legend},xAxis:[{type:"category",axisTick:{show:!1},data:r.x_data}],yAxis:r.yAxis,series:r.series}}if("same"==r.table_type){n.content.columnNames=r.x_data;var p=[];"radar"==r.series[0].type?(console.log(r.series[0].data),_.forEach(r.series[0].data,function(e,t){var n={};n.rowName=e.name,n.rowValue=e.value,p.push(n)})):_.forEach(r.legend,function(e,t){var n={};n.rowName=e,n.rowValue=r.series[t].data,p.push(n)}),n.content.rowData=p}else if("reverse"==r.table_type){n.content.columnNames=r.legend;var p=[];_.forEach(r.x_data,function(e,t){var n={};n.rowName=e;var a=[];"radar"==r.series[0].type?_.forEach(r.series[0].data,function(e,n){var r={};r.name=e.name,r.value=e.value[t],a.push(r)}):_.forEach(r.series,function(e,n){var o={};o.name=e.name,o.value=r.series[n].data[t].value,a.push(o)}),n.rowValue=a,p.push(n)}),n.content.rowData=p}else"form"==r.table_type?(n.content.formTable=!0,e.getTableData(r.table_url,{picCode:n.content.picCode,queryTime:o(n.content.model,n.content.format)}).then(function(e){n.content.rowData=e.data})):e.getTableData(r.table_url,{picCode:n.content.picCode,queryTime:o(n.content.model,n.content.format)}).then(function(e){n.content.columnNames=e.data.columnName,n.content.rowData=e.data.rowData});setTimeout(function(){l=echarts.init(a.find("div")[0]),l.clear(),l.resize(),l.setOption(s)},1e3)}})}console.log(n.content),n.$watch("content.model",function(e,t){e!==t&&e&&t&&i()});var l=null,s={};i(),n.onResize=function(){l&&l.resize()},angular.element(t).bind("resize",function(){n.onResize()})}}}])}();